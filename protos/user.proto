syntax = "proto3";

package user;

// FIX: Changed "hoshiBmaTchi" to "hoshibmatchi" to match your go.mod
option go_package = "github.com/hoshibmatchi/user-service/proto";

service UserService {
  rpc RegisterUser (RegisterUserRequest) returns (RegisterUserResponse);
  rpc SendRegistrationOtp (SendOtpRequest) returns (SendOtpResponse);
  rpc LoginUser (LoginRequest) returns (LoginResponse);
  rpc Verify2FA (Verify2FARequest) returns (Verify2FAResponse);

  rpc SendPasswordReset (SendPasswordResetRequest) returns (SendPasswordResetResponse);
  rpc ResetPassword (ResetPasswordRequest) returns (ResetPasswordResponse);
}

message RegisterUserRequest {
  string name = 1;
  string username = 2;
  string email = 3;
  string password = 4;
  string date_of_birth = 5; // Send as string "YYYY-MM-DD"
  string gender = 6;
  
  // --- ADDED ---
  string profile_picture_url = 7;
  string otp_code = 8;
  // --- END ADDED ---
}

message RegisterUserResponse {
  int64 id = 1;
  string username = 2;
  string email = 3;
}

// --- Send OTP ---
// The request just needs the email
message SendOtpRequest {
  string email = 1;
}

// The response is a success message
message SendOtpResponse {
  string message = 1;
  int32 rate_limit_seconds = 2; // Tell the frontend how long to wait
}

// --- Login ---
message LoginRequest {
  string email_or_username = 1;
  string password = 2;
}

message LoginResponse {
  string message = 1; // e.g., "Login successful" or "2FA required"
  string access_token = 2;
  string refresh_token = 3;
  bool is_2fa_required = 4;
}

// --- 2FA Verification ---
message Verify2FARequest {
  string email = 1;
  string otp_code = 2;
}

// The response is the same as a successful login: it returns tokens
message Verify2FAResponse {
  string access_token = 1;
  string refresh_token = 2;
}

// --- Password Reset (Request) ---
message SendPasswordResetRequest {
  string email = 1;
}

message SendPasswordResetResponse {
  string message = 1; // "Password reset email sent"
}

// --- Password Reset (Submit) ---
message ResetPasswordRequest {
  string email = 1;
  string otp_code = 2; // re-use this name for the reset token
  string new_password = 3;
}

message ResetPasswordResponse {
  string message = 1; // "Password reset successfully"
}